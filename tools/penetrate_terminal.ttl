; QFW1 Penetrate Macro for TeraTerm


anzahl = 10000

do
	; reset terminal
	callmenu 50410
	mpause 500
	clearscreen 0;

	call getprompt

	stringtosend = "show"
	call msend
	mpause 1000
	stringtosend = "get 10"
	call msend
	mpause 250
	stringtosend = "get 11"
	call msend
	mpause 250
	stringtosend = "get 12"
	call msend
	mpause 250
	stringtosend = "get 13"
	call msend
	mpause 250
	stringtosend = "log -c 20 -m"
	call msend
	mpause 800
	stringtosend = "nwnodes -s"
	call msend
	mpause 2000
	stringtosend = "memdump -t fram -o 0x200 -l 300"
	call msend
	mpause 1000
	stringtosend = "fwstore -t zigbee -i"
	call msend
	mpause 2000
	stringtosend = "profile show"
	call msend
	mpause 1500
	stringtosend = "date"
	call msend
	mpause 250
	stringtosend = "uname"
	call msend
	mpause 250
	stringtosend = "uptime"
	call msend
	mpause 250
	stringtosend = "help"
	call msend
	mpause 1000
	stringtosend = "hwinfo"
	call msend
	mpause 250
	stringtosend = "exit"
	call msend
	mpause 500
	flushrecv
	
	call getprompt
	garbage = 0
	while garbage<1000
		if garbage % 53 = 0 then
			call getprompt
		endif
		garbagetosend = garbage % 255
		send garbagetosend
		mpause 10
		garbage = garbage + 1
	endwhile
	mpause 500
	flushrecv
	
	anzahl = anzahl - 1
loop while anzahl>0
end



	; ********************* helper functions *********************

:getprompt
	count = 0
	timeout_old = timeout
	timeout = 1
	sendln
	mpause 100
	sendln
	mpause 100
	flushrecv
	while count < 10
		sendln
		mpause 100
		wait '>'
		if result=1 break
		count = count + 1
	endwhile
	timeout = timeout_old
	mpause 100
return


:msend
    strlen stringtosend
	ccount = result
	idx = 1
	while idx < ccount + 2
		strcopy stringtosend idx 1 substr
		send substr
		mpause 30
		idx = idx + 1
	endwhile
	send 13
return